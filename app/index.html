<!DOCTYPE html>
<html>
    <head>
        <title>Posso ir?</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="css/fonts.css">
        <link rel="stylesheet" href="css/main.css">

        <!--
        Include the maps javascript with sensor=true because this code is using a
        sensor (a GPS locator) to determine the user's location.
        See: https://developers.google.com/maps/documentation/javascript/tutorial#Loading_the_Maps_API
        -->
        <!-- <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script> -->

        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>

        <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see a blank space instead of the map, this
        // is probably because you have denied permission for location sharing.

        var json = [{"ind":2,"loc":[-23.548454,-46.631698],"dp":1},{"ind":7,"loc":[-23.525866,-46.639426],"dp":2},{"ind":3,"loc":[-23.542212,-46.639745],"dp":3},{"ind":1,"loc":[-23.55058,-46.654335],"dp":4},{"ind":3,"loc":[-23.561542,-46.643451],"dp":5},{"ind":3,"loc":[-23.574353,-46.622978],"dp":6},{"ind":2,"loc":[-23.526359,-46.697489],"dp":7},{"ind":6,"loc":[-23.553187,-46.607804],"dp":8},{"ind":2,"loc":[-23.506051,-46.610234],"dp":9},{"ind":6,"loc":[-23.515369,-46.538127],"dp":10},{"ind":4,"loc":[-23.642237,-46.699404],"dp":11},{"ind":3,"loc":[-23.53286,-46.616453],"dp":12},{"ind":6,"loc":[-23.499162,-46.6433],"dp":13},{"ind":4,"loc":[-23.553321,-46.695949],"dp":14},{"ind":3,"loc":[-23.580272,-46.678462],"dp":15},{"ind":4,"loc":[-23.608311,-46.634179],"dp":16},{"ind":3,"loc":[-23.585912,-46.605845],"dp":17},{"ind":5,"loc":[-23.567476,-46.595368],"dp":18},{"ind":4,"loc":[-23.511667,-46.58486],"dp":19},{"ind":6,"loc":[-23.435785,-46.605769],"dp":20},{"ind":4,"loc":[-23.540858,-46.514806],"dp":21},{"ind":4,"loc":[-23.492335,-46.433904],"dp":22},{"ind":3,"loc":[-23.533927,-46.67355],"dp":23},{"ind":6,"loc":[-23.507089,-46.507427],"dp":24},{"ind":4,"loc":[-23.883672,-46.696497],"dp":25},{"ind":6,"loc":[-23.623584,-46.609267],"dp":26},{"ind":4,"loc":[-23.621951,-46.665277],"dp":27},{"ind":3,"loc":[-23.491149,-46.697149],"dp":28},{"ind":4,"loc":[-23.568321,-46.562984],"dp":29},{"ind":3,"loc":[-23.548402,-46.564099],"dp":30},{"ind":5,"loc":[-23.551671,-46.533879],"dp":31},{"ind":4,"loc":[-23.533185,-46.446254],"dp":32},{"ind":5,"loc":[-23.486512,-46.746262],"dp":33},{"ind":3,"loc":[-23.594789,-46.71463],"dp":34},{"ind":3,"loc":[-23.64265,-46.653103],"dp":35},{"ind":3,"loc":[-23.587471,-46.646968],"dp":36},{"ind":3,"loc":[-23.63565,-46.757858],"dp":37},{"ind":4,"loc":[-23.454913,-46.64482],"dp":38},{"ind":3,"loc":[-23.481118,-46.59232],"dp":39},{"ind":4,"loc":[-23.494253,-46.672599],"dp":40},{"ind":4,"loc":[-23.578584,-46.518437],"dp":41},{"ind":4,"loc":[-23.594081,-46.547918],"dp":42},{"ind":4,"loc":[-23.6629,-46.669264],"dp":43},{"ind":3,"loc":[-23.559812,-46.404662],"dp":44},{"ind":4,"loc":[-23.46977,-46.692789],"dp":45},{"ind":4,"loc":[-23.439442,-46.771577],"dp":46},{"ind":6,"loc":[-23.668513,-46.782332],"dp":47},{"ind":4,"loc":[-23.708688,-46.690032],"dp":48},{"ind":7,"loc":[-23.603056,-46.455236],"dp":49},{"ind":6,"loc":[-23.502152,-46.385351],"dp":50},{"ind":3,"loc":[-23.571878,-46.7194],"dp":51},{"ind":4,"loc":[-23.53204,-46.567019],"dp":52},{"ind":5,"loc":[-23.573361,-46.450135],"dp":53},{"ind":5,"loc":[-23.603979,-46.412478],"dp":54},{"ind":5,"loc":[-23.627411,-46.450157],"dp":55},{"ind":5,"loc":[-23.590354,-46.574897],"dp":56},{"ind":4,"loc":[-23.56154,-46.583904],"dp":57},{"ind":4,"loc":[-23.564926,-46.54074],"dp":58},{"ind":5,"loc":[-23.490634,-46.406438],"dp":59},{"ind":4,"loc":[-23.495078,-46.482267],"dp":62},{"ind":6,"loc":[-23.498831,-46.457548],"dp":63},{"ind":4,"loc":[-23.52743,-46.467496],"dp":64},{"ind":4,"loc":[-23.54571,-46.480438],"dp":65},{"ind":4,"loc":[-23.565825,-46.492655],"dp":66},{"ind":4,"loc":[-23.51644,-46.412855],"dp":67},{"ind":4,"loc":[-23.534752,-46.410205],"dp":68},{"ind":7,"loc":[-23.602377,-46.495778],"dp":69},{"ind":4,"loc":[-23.606274,-46.525204],"dp":70},{"ind":8,"loc":[-23.445773,-46.662108],"dp":72},{"ind":6,"loc":[-23.421925,-46.577469],"dp":73},{"ind":4,"loc":[-23.439216,-46.703257],"dp":74},{"ind":4,"loc":[-23.5895,-46.77874],"dp":75},{"ind":3,"loc":[-23.536187,-46.651614],"dp":77},{"ind":4,"loc":[-23.567075,-46.661347],"dp":78},{"ind":4,"loc":[-23.678838,-46.669474],"dp":80},{"ind":4,"loc":[-23.53469,-46.591307],"dp":81},{"ind":4,"loc":[-23.641993,-46.606674],"dp":83},{"ind":5,"loc":[-23.760891,-46.702424],"dp":85},{"ind":4,"loc":[-23.485097,-46.719399],"dp":87},{"ind":6,"loc":[-23.618615,-46.721289],"dp":89},{"ind":4,"loc":[-23.505845,-46.564161],"dp":90},{"ind":6,"loc":[-23.526512,-46.730734],"dp":91},{"ind":4,"loc":[-23.664309,-46.746289],"dp":92},{"ind":3,"loc":[-23.54962,-46.743336],"dp":93},{"ind":4,"loc":[-23.62143,-46.591319],"dp":95},{"ind":3,"loc":[-23.608619,-46.687345],"dp":96},{"ind":5,"loc":[-23.65936,-46.634352],"dp":97},{"ind":7,"loc":[-23.703757,-46.646658],"dp":98},{"ind":4,"loc":[-23.675452,-46.691041],"dp":99},{"ind":4,"loc":[-23.709698,-46.75517],"dp":100},{"ind":6,"loc":[-23.734125,-46.670393],"dp":101},{"ind":4,"loc":[-23.68012,-46.71481],"dp":102},{"ind":4,"loc":[-23.544071,-46.434955],"dp":103}];

        var citymap = {};
        for (var i = 0; i < json.length; i++) {
            citymap[json[i].dp] = {
                center: new google.maps.LatLng(json[i].loc[0], json[i].loc[1]),
                population: 12000
            }
        }

        var color = [];
        color[0] = '#FF081A';
        color[1] = '#FF081A';
        color[2] = '#ff2838';
        color[3] = '#ff6800';
        color[4] = '#ff7a1e';
        color[5] = '#fff700';
        color[6] = '#fff933';
        color[7] = '#abff47';
        color[8] = '#93ff14';
        color[9] = '#84f400';
        color[10] = '#6ecc00';

        var map,
            cityCircle,
            markers = [];

        function initialize() {
          var mapOptions = {
            zoom: 15,
            mapTypeId: google.maps.MapTypeId.TERRAIN
          };
          map = new google.maps.Map(document.getElementById('map-canvas'),
              mapOptions);
        

          // Construct the circle for each value in citymap.
          // Note: We scale the population by a factor of 20.
          var j = 0;
          for (var city in citymap) {
            var populationOptions = {
              strokeColor: color[json[j].ind],
              strokeOpacity: 0.8,
              strokeWeight: 0.1,
              fillColor: color[json[j].ind],
              fillOpacity: 0.35,
              map: map,
              center: citymap[city].center,
              radius: citymap[city].population / 20
            };
            // Add the circle for this city to the map.
            cityCircle = new google.maps.Circle(populationOptions);
            j++;
          }

          var latitude,
              longitude;

          // Try HTML5 geolocation
          if(navigator.geolocation) 
          {
            function geoFirefoxOS() 
            {
              
              var pos = new google.maps.LatLng(latitude, longitude);
            
              var infowindow = new google.maps.Marker({
                map: map,
                position: pos,
                title: 'Você esta Aqui.'
              });
        
              map.setCenter(pos);
            };


            function sucess(position) 
            {
              
              latitude = position.coords.latitude;
              longitude = position.coords.longitude; 

              geoFirefoxOS();
            };

            function error () 
            {
              
              latitude = -23.547465;
              longitude = -46.638436;

              geoFirefoxOS();
            };

            var option = {
              enableHighAccuracy: true, 
              maximumAge        : 3000, 
              timeout           : 2000
            };
            

            navigator.geolocation.getCurrentPosition(sucess, error, option);

          } 
          else 
          {
            handleNoGeolocation(false);
          };


  // Create the search box and link it to the UI element.
  var input = document.getElementById('footer-search-text');
  var searchBox = new google.maps.places.SearchBox(input);
 google.maps.event.addListener(searchBox, 'places_changed', function() {
    var places = searchBox.getPlaces();

    for (var i = 0, marker; marker = markers[i]; i++) {
      marker.setMap(null);
    }

    // For each place, get the icon, place name, and location.
    markers = [];
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0, place; place = places[i]; i++) {
      var image = {
        url: place.icon,
        size: new google.maps.Size(71, 71),
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(17, 34),
        scaledSize: new google.maps.Size(25, 25)
      };

      // Create a marker for each place.
      var marker = new google.maps.Marker({
        map: map,
        icon: image,
        title: place.name,
        position: place.geometry.location
      });

      markers.push(marker);

      bounds.extend(place.geometry.location);
    }

    map.fitBounds(bounds);
  });
  // [END region_getplaces]

  // Bias the SearchBox results towards places that are within the bounds of the
  // current map's viewport.
  google.maps.event.addListener(map, 'bounds_changed', function() {
    var bounds = map.getBounds();
    searchBox.setBounds(bounds);
  });
        }
        
        google.maps.event.addDomListener(window, 'load', initialize); 
    </script>
 
    </head>
    <body>
        <header id="footer">
            <a href="" id="footer-geo" class="fleft space-right">
                <img id="footer-geo-ico" src="./images/footer/geolocation.png">
            </a>

            <form id="footer-search" action="#">
                <input type="text" placeholder="Buscar Região..." id="footer-search-text">
                <input type="submit" value="Ir!" id="footer-search-action" class="fright">
            </form><!-- footer-search -->
        </header><!-- #footer -->

        <nav id="nav-menu" class="none">
            <ul>
                <li>Item 1</li>
                <li>Item 2</li>
                <li>Item 3</li>
                <li>Item 4</li>
            </ul>
        </nav>

          <ul id="legenda-cores">
            <li class="descricao clr">Não<br>Seguro</li>
            <li class="legenda" style="background-color: #FF0000">&nbsp;</li>
            <li class="legenda" style="background-color: #ff3233">&nbsp;</li>
            <li class="legenda" style="background-color: #ff4d47">&nbsp;</li>
            <li class="legenda" style="background-color: #ff6800">&nbsp;</li>
            <li class="legenda" style="background-color: #ff8408">&nbsp;</li>
            <li class="legenda" style="background-color: #ffb91e">&nbsp;</li>
            <li class="legenda" style="background-color: #fff700">&nbsp;</li>
            <li class="legenda" style="background-color: #eeff33">&nbsp;</li>
            <li class="legenda" style="background-color: #abff47">&nbsp;</li>
            <li class="legenda" style="background-color: #93ff14">&nbsp;</li>
            <li class="legenda" style="background-color: #84f400">&nbsp;</li>
            <li class="descricao">Seguro</li>
          </ul>
        <article id="map-canvas" class="clr">
        </article><!-- #map-canvas -->

        <footer id="header" class="overflow">
            <img src="./images/icons/icon32.png" id="header-icon" class="fleft space-right">
            <h1 id="header-title" class="title fleft">Posso ir?</h1>
            <a href="#nav-menu" id="header-menu" class="fright">
                <img src="./images/header/menu.png">
            </a>
        </footer><!-- #header -->
    </body>
</html>
